# Проект Место(бэкенд)

Проект сделан в рамках обучения в Яндекс Практикуме.
Реализована работа сервера:
- регистрация и авторизация пользователей;
- проверка токена;
- создание и передача карточек;
- постановка и снятие лайка карточки.

## Технологии

- Node.js
- Express.js
- Mongo DB

## Директории

`/models` — папка с файлами описания схем пользователя и карточки;  
`/controllers` — папка с файлами контроллеров пользователя и карточки;  
`/routes` — папка с файлами роутера;  
`/errors` — папка с классами ошибок.  

## Роуты

`POST /signup` — регистрация пользователя;  
`POST /signin` — авторизация пользователя;  
`GET /users` — возвращает всех пользователей из базы;  
`GET /users/:userId` — возвращает пользователя по _id ;  
`POST /users` — создаёт пользователя с переданными в теле запроса name , about и avatar;  
`GET /users/me` — возвращает информацию о текущем пользователе;  
`PATCH /users/me` — обновляет профиль пользователя;  
`PATCH /users/me/avatar` — обновляет аватар пользователя;  
`GET /cards` — возвращает все карточки из базы;  
`POST /cards` — создаёт карточку с переданными в теле запроса name и link , устанавливает поле owner для карточки;  
`DELETE /cards/:cardId` — удаляет карточку по _id;  
`PUT /cards/:cardId/likes` — ставит лайк карточке;  
`DELETE /cards/:cardId/likes` — убирает лайк с карточки.  

## Авторизация и регистрация пользователя

- В схеме пользователя есть обязательные поля `email` и `password`;
- Поле `email` уникальное — есть опция `unique: true`;
- Поле `password` не ограничено в длину, так как пароль хранится в виде хеша;
- В контроллере `createUser` почта и хеш пароля записываются в базу;
- Поля `name`, `about` и `avatar` пользователя необязательные. Если они не заполнены в запросе, то в них подставляются стандартные значения;
- Контроллер `login` проверяет полученные в теле запроса почту и пароль;
- Если почта и пароль верные, контроллер login создаёт JWT, в `payload` которого записано свойство `_id` с идентификатором пользователя;
- `JWT-токен` выпускается на срок 7 дней, а не даётся бессрочно;
- В ответ на успешную авторизацию контроллер login возвращает клиенту созданный токен;
- В файле `middlewares/auth.js` middleware авторизации для проверки JWT;
- Пользователь не может удалить карточку, которую он не создавал;
- Пользователь не может редактировать чужой профиль и менять чужой аватар;
- API не возвращает хеш пароля;
- Все роуты, кроме `/signin` и `/signup` защищены авторизацией.

## Валидация данных

- Поле email пользователя валидируется на соответствие паттерну почты;
- Тела запросов и, где необходимо, параметры запроса и заголовки валидируются по определённым схемам с помощью celebrate;
- Если запрос не соответствует схеме, обработка не передаётся контроллеру, клиент получает ошибку валидации;

## Обработка ошибок в приложении

Для ошибок созданы классы конструкторы ошибок, наследуемые от Error.

Если в любом из запросов что-то идёт не так, сервер возвращает ответ с ошибкой и соответствующим ей статусом:
- `400` — переданы некорректные данные в методы создания карточки, пользователя, обновления аватара пользователя или профиля;
- `401` — передан неверный логин или пароль. Также эту ошибку возвращает авторизационный middleware, если передан неверный JWT;
- `403` — попытка удалить чужую карточку;
- `404` — карточка или пользователь не найден или был запрошен несуществующий роут;
- `409` — при регистрации указан email, который уже существует на сервере;
- `500` — ошибка по умолчанию. Сопровождается сообщением: «На сервере произошла ошибка».

При обработке ошибки в блоке catch они не выбрасываются через throw , а передаются в централизованный обработчик ошибок с помощью next.

## Запуск проекта

`npm run start` — запускает сервер на localhost:3000;  
`npm run dev` — запускает сервер на localhost:3000 с hot reload;  
`npm run lint` — запускает проверку проекта на ошибки линтинга.  

## Ссылка на страницу

https://uladzimirfilipau.github.io/express-mesto-gha/
